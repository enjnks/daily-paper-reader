---
title: "Explaining the Explainer: Understanding the Inner Workings of Transformer-based Symbolic Regression Models"
title_zh: 解释解释器：理解基于 Transformer 的符号回归模型的内部工作机制
authors: "Arco van Breda, Erman Acar"
date: 2026-02-03
pdf: "https://arxiv.org/pdf/2602.03506v1"
tags: ["keyword:SR", "query:SR"]
score: 10.0
evidence: 直接研究基于Transformer的符号回归，并引入了一种新的电路发现算法。
tldr: 本研究探讨了基于Transformer的符号回归（SR）模型的内部工作机制。针对SR模型生成数学算子的黑盒问题，作者提出了PATCHES进化电路发现算法，并首次对SR Transformer进行了电路级表征。通过识别28个关键电路并利用因果评估框架进行验证，研究发现均值修补在识别功能性电路方面优于传统的Logit归因法，为符号回归领域的机械可解释性研究提供了系统的方法论。
motivation: 尽管Transformer在符号回归中表现优异，但其生成数学算子的内部机制和电路结构仍处于未探索状态。
method: 提出PATCHES进化算法来自动发现紧凑电路，并采用基于忠实性、完整性和最小性的因果评估框架进行验证。
result: 成功分离出28个功能电路，并证明均值修补结合性能评估能比Logit归因更可靠地识别因果特征而非相关性特征。
conclusion: 本研究确立了符号回归作为机械可解释性的重要应用领域，并为发现和验证模型内部逻辑电路提供了原则性方法。
---

## 摘要
继在多个领域取得成功之后，Transformer 在符号回归（SR）中也表现出了有效性；然而，其生成数学算子的底层内部机制在很大程度上仍未被探索。尽管机械可解释性（mechanistic interpretability）已成功识别出语言和视觉模型中的电路，但尚未应用于符号回归。在本文中，我们介绍了 PATCHES，这是一种进化电路发现算法，用于识别符号回归中紧凑且正确的电路。利用 PATCHES，我们分离出 28 个电路，首次提供了符号回归 Transformer 的电路级表征。我们通过一个基于忠实性（faithfulness）、完整性（completeness）和最小性（minimality）等关键概念的稳健因果评估框架验证了这些发现。我们的分析表明，结合基于性能评估的均值修补（mean patching）能最可靠地分离出功能正确的电路。相比之下，我们证明了直接 Logit 归因（direct logit attribution）和探测分类器（probing classifiers）主要捕捉的是相关性特征而非因果特征，从而限制了它们在电路发现中的效用。总的来说，这些结果确立了符号回归作为机械可解释性具有高潜力的应用领域，并提出了一种原则性的电路发现方法论。

## Abstract
Following their success across many domains, transformers have also proven effective for symbolic regression (SR); however, the internal mechanisms underlying their generation of mathematical operators remain largely unexplored. Although mechanistic interpretability has successfully identified circuits in language and vision models, it has not yet been applied to SR. In this article, we introduce PATCHES, an evolutionary circuit discovery algorithm that identifies compact and correct circuits for SR. Using PATCHES, we isolate 28 circuits, providing the first circuit-level characterisation of an SR transformer. We validate these findings through a robust causal evaluation framework based on key notions such as faithfulness, completeness, and minimality. Our analysis shows that mean patching with performance-based evaluation most reliably isolates functionally correct circuits. In contrast, we demonstrate that direct logit attribution and probing classifiers primarily capture correlational features rather than causal ones, limiting their utility for circuit discovery. Overall, these results establish SR as a high-potential application domain for mechanistic interpretability and propose a principled methodology for circuit discovery.

---

## 论文详细总结（自动生成）

这是一份关于论文《Explaining the Explainer: Understanding the Inner Workings of Transformer-based Symbolic Regression Models》的结构化深入总结：

### 1. 核心问题与整体含义
*   **研究动机**：符号回归（SR）因其能生成可解释的数学公式而备受推崇，但目前主流的基于 Transformer 的神经符号回归模型（如 NeSymReS）本身却是“黑盒”。这种“用不可解释的模型生成可解释的输出”的矛盾现状，促使作者尝试利用**机械可解释性（Mechanistic Interpretability, MI）**技术来逆向工程这些模型。
*   **核心问题**：模型内部哪些组件（注意力头、MLP）负责生成特定的数学算子（如 $\sin, \exp, +$）？能否识别出实现这些功能的最小子图（即“电路”）？

### 2. 方法论
论文提出了一套名为 **PATCHES** 的框架，用于自动化电路发现与验证：
*   **核心思想**：将电路发现视为一个多目标优化问题，即在保持模型性能的同时，尽可能减少参与计算的组件数量。
*   **关键技术细节**：
    *   **PATCHES 算法**：采用**协方差矩阵自适应进化策略（CMA-ES）**。它不依赖梯度，而是通过迭代采样概率掩码（Mask）来优化电路。掩码决定了哪些组件被保留，哪些被“修补”（Patching）。
    *   **适应度函数（Fitness Function）**：$F(C) = |C| + \lambda \sum \max(0, T_i - S_i(C))$。该公式平衡了电路大小 $|C|$ 和性能惩罚（当电路性能低于阈值 $T_i$ 时触发惩罚）。
    *   **激活修补（Activation Patching）**：对比了三种策略：
        1.  **均值修补（Mean Patching）**：用数据集的平均激活值替换。
        2.  **重采样修补（Resample Patching）**：用损坏输入的激活值替换。
        3.  **对称标记替换（STR）**：用语义相近的算子（如用 $\cos$ 替换 $\sin$）的激活值替换。
*   **评估框架**：定义了三个硬性指标：
    1.  **忠实性（Faithfulness）**：仅保留电路时，模型是否仍能正确输出。
    2.  **完整性（Completeness）**：移除电路后，模型是否无法输出目标算子。
    3.  **最小性（Minimality）**：电路中是否不存在冗余组件。

### 3. 实验设计
*   **目标模型**：NeSymReS（一种经典的基于 Transformer 编码器-解码器结构的符号回归模型）。
*   **数据集**：
    *   针对每个算子（如 `add`, `log`, `sin` 等）构建专用数据集，每组包含 500 条公式（100 条用于发现，400 条用于泛化测试）。
    *   使用 **Feynman AI 数据集**（物理公式基准）验证模型的基础性能。
*   **对比方法**：
    *   **迭代修补（Iterative Patching）**：传统的贪心搜索方法。
    *   **直接 Logit 归因（Direct Logit Attribution）**：基于单个组件对输出贡献的排序方法。
    *   **探测分类器（Probing Classifiers）**：测试组件中是否包含相关信息的线性分类器。

### 4. 资源与算力
*   **模型训练**：论文引用了原始 NeSymReS 的训练配置（RTX 2080 GPU，训练 3 天）。
*   **电路发现算力**：文中未明确给出 PATCHES 运行的总机时，但提到由于 BFGS 优化过程是 CPU 密集型且耗时较长，实验中对数据集规模进行了限制（如 1000-10000 样本）。作者指出 PATCHES 相比传统的迭代方法在处理复杂电路时更具效率。

### 5. 实验数量与充分性
*   **实验规模**：
    *   成功分离并分析了 **28 个电路**，涵盖了主要的单元算子（$\sin, \cos, \exp, \log, \tan$）和多元算子（$+, \times, \text{pow}$）。
    *   进行了跨算子的组件重叠分析（Overlap Analysis）和多标记电路（如单项式、多项式函数类）的扩展实验。
*   **充分性与客观性**：实验设计较为全面，不仅验证了电路的有效性，还通过消融实验对比了不同修补策略（均值 vs 重采样）和评估指标（功能准确率 vs Logit 分数）的影响。通过泛化集测试确保了发现的电路不是对特定数据的过拟合。

### 6. 主要结论与发现
*   **PATCHES 的优越性**：相比传统的迭代修补，PATCHES 能发现更小、更忠实的电路，且能有效跳出局部最优。
*   **修补策略偏好**：**均值修补（Mean Patching）结合功能性评估（准确率）**是识别正确电路最可靠的方法。
*   **因果 vs 相关**：证明了 **Logit 归因和探测（Probing）往往捕捉的是相关性而非因果性**。即使某个组件探测准确率很高，它也可能不是模型预测所必需的。
*   **电路密度**：符号回归模型的电路相对稠密（占模型的 40%-78%），这反映了 SR 任务中算子编码的复杂性和多义性。

### 7. 优点
*   **开创性**：首次将机械可解释性引入符号回归领域，填补了该领域的空白。
*   **方法论严谨**：提出了基于进化算法的全局优化路径，克服了现有 MI 方法依赖组件顺序的弊端。
*   **评估体系完备**：建立了一套标准化的忠实性、完整性和最小性评估流程，具有很强的通用性。

### 8. 不足与局限
*   **架构局限**：主要针对 NeSymReS 这一种架构进行了深入分析，虽然声称方法通用，但在其他变体（如纯解码器结构）上的表现尚未验证。
*   **解释深度**：虽然识别出了哪些组件构成了电路，但对于这些组件内部具体如何协同工作（例如具体的数学变换逻辑）的解释仍处于宏观层面。
*   **算力敏感**：进化算法（CMA-ES）虽然效果好，但相比简单的归因方法，其搜索成本仍然较高。

（完）
